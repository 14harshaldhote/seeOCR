<!doctype html>
<html
    lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Users Management - Admin Panel</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
            defer
        ></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
    </head>
    <body class="bg-gray-100">
        <div class="flex h-screen">
            <!-- Sidebar -->
            <div class="bg-blue-800 text-white w-64 space-y-6 py-7 px-2">
                <div class="text-center">
                    <h1 class="text-2xl font-bold">
                        <i class="fas fa-shield-alt mr-2"></i>
                        Admin Panel
                    </h1>
                </div>

                <nav class="space-y-2">
                    <a
                        href="/dashboard"
                        class="flex items-center space-x-2 py-2 px-4 rounded transition duration-200 hover:bg-blue-700"
                    >
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>

                    <a
                        href="/users"
                        class="flex items-center space-x-2 py-2 px-4 rounded transition duration-200 bg-blue-700"
                    >
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </a>

                    <a
                        href="/roles"
                        class="flex items-center space-x-2 py-2 px-4 rounded transition duration-200 hover:bg-blue-700"
                    >
                        <i class="fas fa-user-tag"></i>
                        <span>Roles</span>
                    </a>

                    <div class="border-t border-blue-700 my-4"></div>

                    <a
                        href="/logout"
                        class="flex items-center space-x-2 py-2 px-4 rounded transition duration-200 hover:bg-red-600"
                    >
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <header class="bg-white shadow-sm border-b border-gray-200">
                    <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                        <div class="flex justify-between items-center">
                            <h1 class="text-2xl font-semibold text-gray-900">
                                Users Management
                            </h1>
                            <button
                                onclick="showCreateUserForm()"
                                class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                            >
                                <i class="fas fa-plus mr-2"></i>
                                Add New User
                            </button>
                        </div>
                    </div>
                </header>

                <main
                    class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6"
                >
                    <!-- Users Table -->
                    <div class="bg-white shadow overflow-hidden sm:rounded-md">
                        <div
                            th:if="${#lists.isEmpty(users)}"
                            class="p-6 text-center text-gray-500"
                        >
                            <i class="fas fa-users text-4xl mb-4"></i>
                            <p class="text-lg">No users found</p>
                            <p class="text-sm">
                                Create your first user to get started
                            </p>
                        </div>

                        <ul
                            th:if="${!#lists.isEmpty(users)}"
                            class="divide-y divide-gray-200"
                        >
                            <li
                                th:each="user : ${users}"
                                class="px-6 py-4 hover:bg-gray-50"
                            >
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <div
                                                class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center"
                                            >
                                                <i
                                                    class="fas fa-user text-white"
                                                ></i>
                                            </div>
                                        </div>
                                        <div class="ml-4">
                                            <div
                                                class="text-sm font-medium text-gray-900"
                                                th:text="${user.username}"
                                            >
                                                Username
                                            </div>
                                            <div
                                                class="text-sm text-gray-500"
                                                th:text="${user.email}"
                                            >
                                                Email
                                            </div>
                                            <div class="flex space-x-2 mt-1">
                                                <span
                                                    th:each="role : ${user.roleNames}"
                                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                                                    th:text="${role}"
                                                    >Role</span
                                                >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span
                                            th:if="${user.active}"
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                                        >
                                            <i
                                                class="fas fa-circle text-xs mr-1"
                                            ></i
                                            >Active
                                        </span>
                                        <span
                                            th:unless="${user.active}"
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"
                                        >
                                            <i
                                                class="fas fa-circle text-xs mr-1"
                                            ></i
                                            >Inactive
                                        </span>
                                        <button
                                            onclick="editUser(this)"
                                            th:data-user-id="${user.id}"
                                            class="text-blue-600 hover:text-blue-900 text-sm font-medium"
                                        >
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </main>
            </div>
        </div>

        <!-- Create User Modal -->
        <div
            id="createUserModal"
            class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
        >
            <div
                class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
            >
                <div class="mt-3">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">
                        Create New User
                    </h3>
                    <form id="createUserForm" action="/users" method="post">
                        <div class="mb-4">
                            <label
                                for="newUsername"
                                class="block text-sm font-medium text-gray-700"
                                >Username</label
                            >
                            <input
                                type="text"
                                id="newUsername"
                                name="username"
                                required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>
                        <div class="mb-4">
                            <label
                                for="newEmail"
                                class="block text-sm font-medium text-gray-700"
                                >Email</label
                            >
                            <input
                                type="email"
                                id="newEmail"
                                name="email"
                                required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>
                        <div class="mb-4">
                            <label
                                for="newPassword"
                                class="block text-sm font-medium text-gray-700"
                                >Password</label
                            >
                            <input
                                type="password"
                                id="newPassword"
                                name="password"
                                required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>
                        <input
                            type="hidden"
                            th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}"
                        />
                        <div class="flex justify-end space-x-3">
                            <button
                                type="button"
                                onclick="hideCreateUserForm()"
                                class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                            >
                                Create User
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div
            id="editUserModal"
            class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"
        >
            <div
                class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
            >
                <div class="mt-3">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">
                        Edit User
                    </h3>
                    <form id="editUserForm" method="post">
                        <input type="hidden" id="editUserId" name="id" />
                        <div class="mb-4">
                            <label
                                for="editUsername"
                                class="block text-sm font-medium text-gray-700"
                                >Username</label
                            >
                            <input
                                type="text"
                                id="editUsername"
                                name="username"
                                required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>
                        <div class="mb-4">
                            <label
                                for="editEmail"
                                class="block text-sm font-medium text-gray-700"
                                >Email</label
                            >
                            <input
                                type="email"
                                id="editEmail"
                                name="email"
                                required
                                class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                            />
                        </div>
                        <div class="mb-4">
                            <label class="flex items-center">
                                <input
                                    type="checkbox"
                                    id="editActive"
                                    name="active"
                                    class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                />
                                <span class="ml-2 text-sm text-gray-600"
                                    >Active</span
                                >
                            </label>
                        </div>
                        <input
                            type="hidden"
                            th:name="${_csrf.parameterName}"
                            th:value="${_csrf.token}"
                        />
                        <div class="flex justify-end space-x-3">
                            <button
                                type="button"
                                onclick="hideEditUserForm()"
                                class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"
                            >
                                Cancel
                            </button>
                            <button
                                type="submit"
                                class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                            >
                                Update User
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            function showCreateUserForm() {
                document
                    .getElementById("createUserModal")
                    .classList.remove("hidden");
            }

            function hideCreateUserForm() {
                document
                    .getElementById("createUserModal")
                    .classList.add("hidden");
                document.getElementById("createUserForm").reset();
            }

            function editUser(button) {
                const userId = button.getAttribute("data-user-id");
                const userRow = button.closest("li");
                const username =
                    userRow.querySelector(".text-gray-900").textContent;
                const email =
                    userRow.querySelector(".text-gray-500").textContent;
                const isActive =
                    userRow.querySelector(".bg-green-100") !== null;

                document.getElementById("editUserId").value = userId;
                document.getElementById("editUsername").value = username;
                document.getElementById("editEmail").value = email;
                document.getElementById("editActive").checked = isActive;
                document.getElementById("editUserForm").action =
                    "/users/" + userId;

                document
                    .getElementById("editUserModal")
                    .classList.remove("hidden");
            }

            function hideEditUserForm() {
                document
                    .getElementById("editUserModal")
                    .classList.add("hidden");
                document.getElementById("editUserForm").reset();
            }

            // Close modals when clicking outside
            window.onclick = function (event) {
                const createModal = document.getElementById("createUserModal");
                const editModal = document.getElementById("editUserModal");

                if (event.target === createModal) {
                    hideCreateUserForm();
                }
                if (event.target === editModal) {
                    hideEditUserForm();
                }
            };
        </script>
    </body>
</html>
